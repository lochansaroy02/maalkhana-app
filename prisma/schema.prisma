generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model District {
  id           String   @id @default(uuid())
  name         String
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  users        User[]
}

model User {
  id            String          @id @default(uuid())
  name          String
  email         String          @unique
  passwordHash  String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  districtId    String
  policeStation String?
  rank          String?
  role          String?
  mobileNo      String
  entries       MalkhanaEntry[]
  vehicles      SeizedVehicle[]
  District      District        @relation(fields: [districtId], references: [id])
}

model SeizedVehicle {
  id             String   @id @default(cuid())
  srNo           String?
  gdNo           String
  gdDate         String
  underSection   String
  rtoName        String?
  vehicleType    String
  colour         String
  registrationNo String
  engineNo       String
  description    String
  status         String
  policeStation  String
  ownerName      String
  seizedBy       String
  caseProperty   String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  districtId     String?
  firNo          String?
  userId         String?
  address        String?
  document       String?
  fathersName    String?
  mobile         String?
  dbName         String?

  // --- Release Fields ---
  isRelease          Boolean?  @default(false)
  releaseDate        DateTime?
  releaseItemName    String?
  releaseOrderedBy   String?
  receiverName       String?
  receivedBy         String?
  releasePhoto       String? // Legacy field
  releasedDocument   String? // Legacy field
  releasePhotoUrl    String? // New consistent naming
  releaseDocumentUrl String?

  // --- Movement Fields ---
  isMovement       Boolean?  @default(false)
  moveDate         String?
  movePurpose      String?
  moveTrackingNo   String?
  takenOutBy       String?
  returnBackFrom   String?
  returnDate       DateTime?
  movementPhoto    String? // Legacy field
  movementDocument String? // Legacy field
  movementPhotoUrl String?
  movementDocUrl   String?

  // --- Nilami (Auction) Fields ---
  isNilami        Boolean? @default(false)
  nilamiOrderedBy String?
  nilamiValue     String?
  nilamiDate      String?
  nilamiItemName  String?
  nilamiPhotoUrl  String?
  nilamiDocUrl    String?

  // --- Destroy Fields ---
  isDestroy        Boolean?  @default(false)
  destroyOrderedBy String?
  destroyDate      DateTime?
  destroyPurpose   String?
  destroyPhotoUrl  String?
  destroyDocUrl    String?

  // Base Photos/Docs
  photoUrl    String?
  documentUrl String?
  isReturned  Boolean @default(false)

  // Relations
  User        User?        @relation(fields: [userId], references: [id])
  attachments Attachment[]
}

model MalkhanaEntry {
  id    String  @id @default(uuid())
  firNo String?

  srNo            Int?      @default(1)
  registrationNo  String?
  entryType       String
  gdNo            Int?
  caseProperty    String
  gdDate          String
  underSection    String
  vadiName        String
  accused         String
  IOName          String
  name            String?
  HM              String
  policeStation   String
  Year            Int?
  boxNo           Int?
  status          String
  place           String
  courtNo         String
  courtName       String
  wine            Int?
  cash            Int?
  wineType        String
  yellowItemPrice Int?
  address         String?
  createdAt       DateTime? @default(now())
  updatedAt       DateTime? @updatedAt
  districtId      String?
  userId          String?
  fathersName     String?
  mobile          String?
  description     String?
  dbName          String?

  // --- Release Fields ---
  isRelease          Boolean?  @default(false)
  releaseDate        DateTime?
  releaseItemName    String?
  releaseOrderedBy   String?
  receiverName       String?
  receivedBy         String?
  releasePhotoUrl    String?
  releaseDocumentUrl String?

  // --- Movement Fields ---
  isMovement          Boolean?  @default(false)
  moveDate            String?
  movePurpose         String?
  moveTrackingNo      String?
  takenOutBy          String?
  returnBackFrom      String?
  returnDate          DateTime?
  movementPhotoUrl    String?
  movementDocumentUrl String?

  // --- Nilami (Auction) Fields ---
  isNilami          Boolean? @default(false)
  nilamiOrderedBy   String?
  nilamiValue       String?
  nilamiDate        String?
  nilamiItemName    String?
  nilamiPhotoUrl    String?
  nilamiDocumentUrl String?

  // --- Destroy Fields ---
  isDestroy          Boolean?  @default(false)
  destroyOrderedBy   String?
  destroyDate        DateTime?
  destroyPurpose     String?
  destroyPhotoUrl    String?
  destroyDocumentUrl String?

  // Base Photos/Docs
  photoUrl    String   @default("")
  document    String?
  documentUrl String?
  isReturned  Boolean? @default(false)

  // Relations
  User        User?        @relation(fields: [userId], references: [id])
  attachments Attachment[]
}

enum AttachmentType {
  INITIAL
  RELEASE
  MOVEMENT
  NILAMI
  DESTROY
}

model Attachment {
  id        String         @id @default(uuid())
  url       String
  fileType  String
  category  AttachmentType
  createdAt DateTime       @default(now())

  malkhanaId String?
  Malkhana   MalkhanaEntry? @relation(fields: [malkhanaId], references: [id])

  vehicleId String?
  Vehicle   SeizedVehicle? @relation(fields: [vehicleId], references: [id])
}
